<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">
	
	<!-- 전체 게시물 갯수 구하기 -->
	<select id="selectTotalCnt" parameterType="String" resultType="int">
		<![CDATA[
			select count(*)
			from board b, users u
			where b.user_no = u.no
		]]>
		<if test="_parameter != null and _parameter !='' ">
            and b.title like '%' || #{keyword} || '%'
		</if>			 
	</select>
	
	
	<!-- 게시판 페이징 연습용 리스트 -->
	<select id="selectList2" parameterType="map" resultType="com.javaex.vo.BoardVo">
		<![CDATA[
			select rt.rn,
			       rt.no,
			       rt.title,
			       rt.hit,
			       rt.regdate,
			       rt.userNo,
			       rt.name
			from (select rownum rn,
			             ot.no,
			             ot.title,
			             ot.hit,
			             ot.regdate,
			             ot.userNo,
			             ot.name
			      from (select b.no,
			                   b.title,
			                   b.hit,
			                   b.reg_date regDate,
			                   b.user_no userNo,
			                   u.name
			            from board b, users u
			            where b.user_no = u.no
		]]>            
					<if test="keyword != null and keyword !='' ">
			            and b.title like '%' || #{keyword} || '%'
					</if>			            
			
		<![CDATA[            
			            order by b.no desc ) ot ) rt
			where rn>= #{startRnum}
			and rn<= #{endRnum}
		]]>
	</select>
	
	
	
	
	<!-- 조회수 올리기(글읽기) -->
	<update id="updateHit" parameterType="int">
		<![CDATA[
			update board
			set hit = hit + 1
			where no = #{no}
		]]>
	</update>


	<!-- 게시판1개 정보 가져오기 -->
	<select id="selectBoard" parameterType="int" resultType="com.javaex.vo.BoardVo">
		<![CDATA[
			select bo.no,
			       us.name,
			       bo.hit,
			       bo.reg_date as regDate,
			       bo.title,
			       bo.content,
			       bo.user_no as userNo
			from users us,
			     board bo
			where us.no = bo.user_no
			and bo.no = #{no}
		]]>
	</select>


	<!-- BoardList 가져오기 -->
	<select id="boardList" parameterType="String" resultType="com.javaex.vo.BoardVo">
		<![CDATA[
			select bo.no,
				   bo.title,
				   us.name,
				   bo.hit,
				   bo.reg_date as regDate,
				   bo.user_no as userNo
			from users us, board bo
			where us.no = bo.user_no
		]]>
			<if test=" value != null and value !='' "> <!--oracle은 % || #{value} || %도 가능함(?) -->
				and us.name || bo.title like '%' || #{keyword} || '%'
			</if>
		<![CDATA[
			order by bo.reg_date desc
		]]>
	</select>


	<!-- 게시판 글쓰기 -->
	<insert id="boardWrite" parameterType="com.javaex.vo.BoardVo">
      <![CDATA[
         insert into board
         values ( seq_board_no.nextval
               ,#{title}
               ,#{content}
               ,0
               ,sysdate
               ,#{userNo}
               )      
      ]]>
	</insert>


	<!-- 게시판 글삭제 -->
	<delete id="boardDelete" parameterType="int">
      <![CDATA[
         delete from board
         where no = #{no}
      ]]>
	</delete>
	
	
	<!-- 게시물 수정 -->
	<update id="boardModify" parameterType="com.javaex.vo.BoardVo">
		<![CDATA[
			UPDATE board
			SET title = #{title},
				content = #{content}
				where no = #{no}
		]]>
	</update>
</mapper>